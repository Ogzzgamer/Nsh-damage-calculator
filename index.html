<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‚·å®³è¨ˆç®—å™¨ - æœªåŒ…å«å…§åŠŸæ•ˆç›Šè¨ˆç®—åˆç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<link href="https://fonts.googleapis.com/css2?family=Inter&family=Noto+Sans+TC&display=swap" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            background: 
				radial-gradient(ellipse at top left, rgba(139, 92, 246, 0.3) 0%, transparent 50%),
				radial-gradient(ellipse at top right, rgba(59, 130, 246, 0.2) 0%, transparent 50%),
				radial-gradient(ellipse at bottom left, rgba(168, 85, 247, 0.2) 0%, transparent 50%),
				radial-gradient(ellipse at bottom right, rgba(99, 102, 241, 0.3) 0%, transparent 50%),
				radial-gradient(ellipse at center, #1e3a8a 0%, #0f172a 70%, #000000 100%);
			position: relative;
			overflow-x: hidden;
			min-height: 100vh;
			font-family: 'Noto Sans TC', sans-serif;
        }
		*:lang(en) {
			font-family: 'Inter', sans-serif;
		}
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .card-shadow:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        .stat-input {
            transition: all 0.3s ease;
            color: #1e293b;
        }
        .stat-input:focus {
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.25);
        }
        .set-effect-card {
            transition: all 0.3s ease;
            border-left: 4px solid;
        }
        .set-effect-card:hover {
            transform: scale(1.02);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .glow {
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.4);
        }
        .result-card {
            background: linear-gradient(135deg, #6d28d9, #8b5cf6);
            color: white;
        }
        .section-title {
            background: linear-gradient(90deg, #f0f0f0, #d2e5ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.2);
        }
        .gradient-divider {
            height: 3px;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            border-radius: 3px;
        }
        .level-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 5px;
        }
        .level-85 { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; }
        .level-83 { background: linear-gradient(135deg, #94a3b8, #64748b); color: white; }
        .level-81 { background: linear-gradient(135deg, #a16207, #854d0e); color: white; }
        .five-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.5rem;
        }
        .five-stat-card {
            background: #a78bfa;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            border: 1px solid #8b5cf6;
			box-shadow: 0 4px 15px rgba(139, 92, 246, 0.35);
        }
        .five-stat-value {
            font-size: 1.25rem;
            font-weight: bold;
            color: #f0f0f0;
        }
        .five-stat-label {
            font-size: 0.85rem;
            color: #eeeeee;
        }
        .stat-diff {
            font-size: 0.85rem;
            font-weight: 500;
            padding: 0 4px;
            border-radius: 4px;
        }
        .stat-increase {
            background-color: rgba(16, 185, 129, 0.1);
            color: #34d399;
        }
        .stat-decrease {
            background-color: rgba(239, 68, 68, 0.1);
            color: #f87171;
        }
        .conversion-card {
            background: rgba(56, 189, 248, 0.15);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(56, 189, 248, 0.3);
        }
        .conversion-header {
            background: linear-gradient(90deg, #f0f0f0, #818cf8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .damage-result-card {
            border-left: 4px solid;
            padding: 12px;
            border-radius: 8px;
        }
        .damage-increase {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.05);
        }
        .damage-decrease {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.05);
        }
        .set-effect-header {
            position: relative;
            padding-bottom: 8px;
            margin-bottom: 12px;
        }
        .set-effect-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #8b5cf6, transparent);
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            background: linear-gradient(to right, #4f46e5, #7c3aed);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transform: translateX(200%);
            transition: transform 0.4s ease;
        }
        .notification.show {
            transform: translateX(0);
        }
        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #8b5cf6;
            border-bottom-color: transparent;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }
        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .unique-badge {
            background: linear-gradient(135deg, #ec4899, #8b5cf6);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 5px;
        }
        .set-badge {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 5px;
        }
        
        /* æ·»åŠ é…è‰² */
        .card-gradient-1 { background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); }
        .card-gradient-2 { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
        .card-gradient-3 { background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%); }
        .card-gradient-4 { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
        .card-gradient-5 { background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%); }
        .card-gradient-6 { background: linear-gradient(135deg, #581c87 0%, #4c1d95 100%); }
        .card-gradient-7 { background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%); }
        .card-gradient-8 { background: linear-gradient(135deg, #374151 0%, #1f2937 100%); }
        .card-gradient-9 { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); }
        
        /* æ˜Ÿç©ºèƒŒæ™¯æ¨£å¼ */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 2s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .meteor {
            position: fixed;
            width: 2px;
            height: 2px;
            background: linear-gradient(45deg, #fff, transparent);
            border-radius: 50%;
            box-shadow: 0 0 10px #fff, 0 0 20px #fff, 0 0 30px #fff;
            animation: meteor 3s linear infinite;
            z-index: 1;
        }

        @keyframes meteor {
            0% {
                transform: translateX(-100px) translateY(-100px);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateX(100vw) translateY(100vh);
                opacity: 0;
            }
        }

        .stardust {
            position: fixed;
            width: 1px;
            height: 1px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            animation: float 8s linear infinite;
            z-index: 1;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) translateX(50px);
                opacity: 0;
            }
        }
        

        
        /* æ˜Ÿç©ºé¢¨æ ¼æŒ‰éˆ• */
        .star-btn {
            background: linear-gradient(135deg, var(--from-color), var(--to-color));
            border: none;
            color: white;
            border-radius: 12px;
            font-weight: 600;
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2), 
                        0 0 15px rgba(139, 92, 246, 0.4);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: translateY(0);
        }
        
        .star-btn i {
            margin-right: 8px;
            font-size: 1.1em;
        }
        
        .star-btn:hover {
            transform: translateY(-4px) scale(1.03);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3), 
                        0 0 20px rgba(139, 92, 246, 0.6);
        }
        
        .star-btn:active {
            transform: translateY(2px) scale(0.98);
        }
        
        .star-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .star-btn:hover::before {
            left: 100%;
        }
        
        .damage-btn {
            --from-color: #f87171;
            --to-color: #ef4444;
        }
        
        .base-btn {
            --from-color: #6366f1;
            --to-color: #4f46e5;
        }
        
        .new-equip-btn {
            --from-color: #ec4899;
            --to-color: #d946ef;
        }
        
        .calc-btn {
            --from-color: #8b5cf6;
            --to-color: #7c3aed;
        }
		
		
    </style>
</head>
<body class="min-h-screen p-4" style="background: radial-gradient(ellipse at bottom, #1e3a8a 0%, #0f172a 100%);">
	<div class="stars" id="stars"></div>
    <div class="max-w-7xl mx-auto">
        <!-- æ¨™é¡Œ -->
        <div class="text-center mb-8 mt-4">
            <h1 class="text-4xl font-bold text-white mb-2">å‚·å®³è¨ˆç®—å™¨</h1>
            <p class="text-purple-300 mb-4">æœªåŒ…å«å…§åŠŸæ•ˆç›Šåˆç‰ˆ</p>
            <div class="w-32 h-1 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full mx-auto"></div>
        </div>

        <!-- æ•¸æ“šåŠ è¼‰ç‹€æ…‹ -->
        <div id="dataLoading" class="text-center p-8">
            <div class="loader mx-auto mb-4"></div>
            <p class="text-purple-300 font-medium">æ­£åœ¨åŠ è¼‰è£å‚™èˆ‡ç›®æ¨™æ•¸æ“š...</p>
            <p class="text-sm text-purple-200 mt-2">è«‹ç¨å€™ï¼Œæ•¸æ“šå°‡å¾å¤–éƒ¨JSONæ–‡ä»¶åŠ è¼‰</p>
        </div>

        <!-- è·æ¥­é¸æ“‡å€åŸŸ (åˆå§‹éš±è—) -->
        <div id="appContent" class="hidden">
            <!-- è·æ¥­é¸æ“‡å€åŸŸ -->
            <div class="mb-8">
                <div class="card-shadow rounded-2xl p-6 card-gradient-1 card-hover">
                    <h2 class="text-xl font-semibold mb-6 section-title">âš”ï¸ è·æ¥­é¸æ“‡</h2>
                    <div class="grid lg:grid-cols-3 gap-6">
                        <!-- ä¸»è·æ¥­é¸æ“‡ -->
                        <div>
                            <h3 class="text-lg font-medium mb-3 text-gray-100"><i class="fas fa-crown mr-2 text-amber-300"></i>ä¸»è·æ¥­</h3>
                            <select id="mainProfessionSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white bg-opacity-90 text-gray-800">
                                <option value="">è«‹é¸æ“‡ä¸»è·æ¥­</option>
                                <optgroup label="å…§åŠŸè·æ¥­">
                                    <option value="ç¥ç›¸" selected>ç¥ç›¸</option>
                                    <option value="ä¹éˆ">ä¹éˆ</option>
                                    <option value="ç´ å•">ç´ å•</option>
                                    <option value="é¾åŸ">é¾åŸ</option>
                                </optgroup>
                                <optgroup label="å¤–åŠŸè·æ¥­">
                                    <option value="ç¢å¤¢">ç¢å¤¢</option>
                                    <option value="éµè¡£">éµè¡£</option>
                                    <option value="è¡€æ²³">è¡€æ²³</option>
                                </optgroup>
                            </select>
                        </div>

                        <!-- ç‰¹è³ªé¸æ“‡ -->
                        <div>
                            <h3 class="text-lg font-medium mb-3 text-gray-100"><i class="fas fa-star mr-2 text-purple-300"></i>ç‰¹è³ª (å‰¯è·æ¥­)</h3>
                            <select id="traitSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white bg-opacity-90 text-gray-800">
                                <option value="">è«‹é¸æ“‡ç‰¹è³ª</option>
                                <optgroup label="å…§åŠŸç‰¹è³ª">
                                    <option value="ç¥ç›¸">ç¥ç›¸</option>
                                    <option value="ä¹éˆ">ä¹éˆ</option>
                                    <option value="ç´ å•">ç´ å•</option>
                                    <option value="é¾åŸ" selected>é¾åŸ</option>
                                </optgroup>
                                <optgroup label="å¤–åŠŸç‰¹è³ª">
                                    <option value="ç¢å¤¢">ç¢å¤¢</option>
                                    <option value="éµè¡£">éµè¡£</option>
                                    <option value="è¡€æ²³">è¡€æ²³</option>
                                </optgroup>
                            </select>
                        </div>

                        <!-- è·æ¥­æ•ˆæœé¡¯ç¤º -->
                        <div>
                            <h3 class="text-lg font-medium mb-3 text-gray-100"><i class="fas fa-magic mr-2 text-blue-300"></i>è·æ¥­æ•ˆæœ</h3>
                            <div id="professionEffects" class="text-sm bg-white bg-opacity-20 p-3 rounded-lg h-32 text-white">
                                <div class="flex items-center justify-center h-full">
                                    <i class="fas fa-info-circle mr-2"></i>è«‹é¸æ“‡è·æ¥­æŸ¥çœ‹æ•ˆæœ
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç›®æ¨™é¸æ“‡å€åŸŸ -->
            <div class="mb-8">
                <div class="card-shadow rounded-2xl p-6 card-gradient-2 card-hover">
                    <div class="grid lg:grid-cols-2 gap-6">
                        <!-- ç›®æ¨™é¸æ“‡ -->
                        <div>
                            <h2 class="text-xl font-semibold mb-4 section-title">ğŸ¯ é¸æ“‡ç›®æ¨™</h2>
                            <select id="targetSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white bg-opacity-90 text-gray-800">
                                <option value="">è«‹é¸æ“‡ç›®æ¨™</option>
                                <!-- ç›®æ¨™é¸é …å°‡å¾JSONåŠ è¼‰ -->
                            </select>
                        </div>

                        <!-- ç›®æ¨™å±¬æ€§é¡¯ç¤º -->
                        <div>
                            <h3 class="text-xl font-semibold mb-4 section-title">ğŸ“Š ç›®æ¨™å±¬æ€§</h3>
                            <div id="targetStats" class="space-y-2 text-sm p-3 bg-white bg-opacity-20 rounded-lg text-white">
                                <div class="flex items-center justify-center h-24">
                                    <i class="fas fa-crosshairs mr-2"></i>è«‹å…ˆé¸æ“‡ç›®æ¨™
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- äº”ç¶­å±¬æ€§é¡¯ç¤ºå€åŸŸ -->
            <div class="mb-8">
                <div class="card-shadow rounded-2xl p-6 card-gradient-3 card-hover">
                    <h2 class="text-xl font-semibold mb-6 section-title">ğŸ“Š äº”ç¶­å±¬æ€§</h2>
                    <div class="five-stats-grid">
                        <div class="five-stat-card">
                            <div class="five-stat-value" id="strengthValue">200</div>
                            <div class="five-stat-label">åŠ›é‡</div>
                        </div>
                        <div class="five-stat-card">
                            <div class="five-stat-value" id="qihaiValue">180</div>
                            <div class="five-stat-label">æ°£æµ·</div>
                        </div>
                        <div class="five-stat-card">
                            <div class="five-stat-value" id="agilityValue">150</div>
                            <div class="five-stat-label">èº«æ³•</div>
                        </div>
                        <div class="five-stat-card">
                            <div class="five-stat-value" id="constitutionValue">120</div>
                            <div class="five-stat-label">æ ¹éª¨</div>
                        </div>
                        <div class="five-stat-card">
                            <div class="five-stat-value" id="enduranceValue">100</div>
                            <div class="five-stat-label">è€åŠ›</div>
                        </div>
                    </div>
                    <div class="mt-4 text-sm text-purple-200">
                        <p><i class="fas fa-info-circle text-blue-300 mr-2"></i>äº”ç¶­å±¬æ€§æœƒæ ¹æ“šè·æ¥­è‡ªå‹•è½‰æ›ç‚ºæˆ°é¬¥å±¬æ€§</p>
                    </div>
                </div>
            </div>

            <!-- äº”ç¶­å±¬æ€§è½‰æ›é¡¯ç¤º -->
            <div class="mb-8">
                <div class="card-shadow rounded-2xl p-6 card-gradient-4 card-hover">
                    <h2 class="text-xl font-semibold mb-6 section-title">ğŸ”„ äº”ç¶­å±¬æ€§è½‰æ›</h2>
                    <div class="grid md:grid-cols-2 gap-6" id="conversionDisplay">
                        <div class="text-center py-4 text-white">
                            è«‹é¸æ“‡è·æ¥­æŸ¥çœ‹è½‰æ›è¦å‰‡
                        </div>
                    </div>
                </div>
            </div>

            <!-- å‚·å®³è¨ˆç®—å€åŸŸ -->
            <div class="mt-8">
                <div class="card-shadow rounded-2xl p-6 card-gradient-5 card-hover">
                    <h2 class="text-xl font-semibold mb-4 section-title">âš”ï¸ å‚·å®³è¨ˆç®—å™¨</h2>
                    <div class="grid lg:grid-cols-3 gap-6">
                        <!-- ç•¶å‰ç¸½å±¬æ€§è¼¸å…¥ -->
                        <div>
                            <h3 class="text-lg font-medium mb-3 text-purple-200"><i class="fas fa-calculator mr-2 text-blue-300"></i>ç•¶å‰ç¸½å±¬æ€§ (å«è£å‚™)</h3>
                            <div class="space-y-3">
                                <div class="grid grid-cols-2 gap-2">
                                    <div>
                                        <label class="block text-sm mb-1 text-purple-200">æ”»æ“Š</label>
                                        <input type="number" id="current_attack" class="w-full p-2 border border-gray-300 rounded-lg text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="3500">
                                    </div>
                                    <div>
                                        <label class="block text-sm mb-1 text-purple-200">å…ƒç´ æ”»æ“Š</label>
                                        <input type="number" id="current_elemental_attack" class="w-full p-2 border border-gray-300 rounded-lg text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="1800">
                                    </div>
                                    <div>
                                        <label class="block text-sm mb-1 text-purple-200">ç ´é˜²</label>
                                        <input type="number" id="current_armor_break" class="w-full p-2 border border-gray-300 rounded-lg text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="1200">
                                    </div>
                                    <div>
                                        <label class="block text-sm mb-1 text-purple-200">å¿½è¦–æŠ—æ€§</label>
                                        <input type="number" id="current_ignore_resist" class="w-full p-2 border border-gray-300 rounded-lg text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="300">
                                    </div>
                                    <div>
                                        <label class="block text-sm mb-1 text-purple-200">å‘½ä¸­</label>
                                        <input type="number" id="current_hit" class="w-full p-2 border border-gray-300 rounded-lg text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="800">
                                    </div>
                                    <div>
                                        <label class="block text-sm mb-1 text-purple-200">æœƒå¿ƒ</label>
                                        <input type="number" id="current_crit" class="w-full p-2 border border-gray-300 rounded-lg text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="1500">
                                    </div>
                                    <div>
                                        <label class="block text-sm mb-1 text-purple-200">é¦–é ˜å…‹åˆ¶</label>
                                        <input type="number" id="current_boss_damage" class="w-full p-2 border border-gray-300 rounded-lg text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="450">
                                    </div>
                                    <div>
                                        <label class="block text-sm mb-1 text-purple-200">é¦–é ˜å…‹åˆ¶%</label>
                                        <input type="number" id="current_boss_damage_percent" class="w-full p-2 border border-gray-300 rounded-lg text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="12.5" step="0.1">
                                    </div>
                                    <div>
                                        <label class="block text-sm mb-1 text-purple-200">æœƒå¿ƒå‚·å®³%</label>
                                        <input type="number" id="current_crit_damage" class="w-full p-2 border border-gray-300 rounded-lg text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="165.0" step="0.1">
                                    </div>
                                    <div>
                                        <label class="block text-sm mb-1 text-purple-200">ç ´ç›¾</label>
                                        <input type="number" id="current_shield_break" class="w-full p-2 border border-gray-300 rounded-lg text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="200">
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <h4 class="text-md font-medium mb-2 text-purple-200"><i class="fas fa-dumbbell mr-2 text-cyan-300"></i>äº”ç¶­å±¬æ€§</h4>
                                    <div class="grid grid-cols-2 gap-2">
                                        <div>
                                            <label class="block text-sm mb-1 text-purple-200">åŠ›é‡</label>
                                            <input type="number" id="current_strength" class="w-full p-2 border border-gray-300 rounded-lg text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="200">
                                        </div>
                                        <div>
                                            <label class="block text-sm mb-1 text-purple-200">æ°£æµ·</label>
                                            <input type="number" id="current_qihai" class="w-full p-2 border border-gray-300 rounded-lg text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="180">
                                        </div>
                                        <div>
                                            <label class="block text-sm mb-1 text-purple-200">èº«æ³•</label>
                                            <input type="number" id="current_agility" class="w-full p-2 border border-gray-300 rounded-lg text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="150">
                                        </div>
                                        <div>
                                            <label class="block text-sm mb-1 text-purple-200">æ ¹éª¨</label>
                                            <input type="number" id="current_constitution" class="w-full p-2 border border-gray-300 rounded-lg text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="120">
                                        </div>
                                        <div>
                                            <label class="block text-sm mb-1 text-purple-200">è€åŠ›</label>
                                            <input type="number" id="current_endurance" class="w-full p-2 border border-gray-300 rounded-lg text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="100">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- æ‰‹å‹•å¾®èª¿å€åŸŸ -->
                        <div>
                            <h3 class="text-lg font-medium mb-3 text-purple-200"><i class="fas fa-sliders-h mr-2 text-purple-300"></i>æ‰‹å‹•å¾®èª¿ (å¯é¸)</h3>
                            <div class="p-4 bg-white bg-opacity-20 rounded-lg border border-gray-200">
                                <h4 class="text-sm font-medium mb-3 text-purple-200">æ–°è£å‚™é¡å¤–èª¿æ•´</h4>
                                <div class="grid grid-cols-2 gap-2">
                                    <div>
                                        <label class="block text-sm mb-1 text-purple-200">æ”»æ“Š</label>
                                        <input type="number" id="manual_attack" class="w-full p-2 border border-gray-300 rounded text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="0">
                                    </div>
                                    <div>
                                        <label class="block text-sm mb-1 text-purple-200">å…ƒç´ æ”»æ“Š</label>
                                        <input type="number" id="manual_elemental_attack" class="w-full p-2 border border-gray-300 rounded text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="0">
                                    </div>
                                    <div>
                                        <label class="block text-sm mb-1 text-purple-200">ç ´é˜²</label>
                                        <input type="number" id="manual_armor_break" class="w-full p-2 border border-gray-300 rounded text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="0">
                                    </div>
                                    <div>
                                        <label class="block text-sm mb-1 text-purple-200">å¿½è¦–æŠ—æ€§</label>
                                        <input type="number" id="manual_ignore_resist" class="w-full p-2 border border-gray-300 rounded text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="0">
                                    </div>
                                    <div>
                                        <label class="block text-sm mb-1 text-purple-200">å‘½ä¸­</label>
                                        <input type="number" id="manual_hit" class="w-full p-2 border border-gray-300 rounded text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="0">
                                    </div>
                                    <div>
                                        <label class="block text-sm mb-1 text-purple-200">æœƒå¿ƒ</label>
                                        <input type="number" id="manual_crit" class="w-full p-2 border border-gray-300 rounded text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="0">
                                    </div>
                                    <div>
                                        <label class="block text-sm mb-1 text-purple-200">é¦–é ˜å…‹åˆ¶</label>
                                        <input type="number" id="manual_boss_damage" class="w-full p-2 border border-gray-300 rounded text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="0">
                                    </div>
                                    <div>
                                        <label class="block text-sm mb-1 text-purple-200">é¦–é ˜å…‹åˆ¶%</label>
                                        <input type="number" id="manual_boss_damage_percent" class="w-full p-2 border border-gray-300 rounded text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="0" step="0.1">
                                    </div>
                                    <div>
                                        <label class="block text-sm mb-1 text-purple-200">æœƒå¿ƒå‚·å®³%</label>
                                        <input type="number" id="manual_crit_damage" class="w-full p-2 border border-gray-300 rounded text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="0" step="0.1">
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <h4 class="text-sm font-medium mb-3 text-purple-200">äº”ç¶­å±¬æ€§èª¿æ•´</h4>
                                    <div class="grid grid-cols-2 gap-2">
                                        <div>
                                            <label class="block text-sm mb-1 text-purple-200">åŠ›é‡</label>
                                            <input type="number" id="manual_strength" class="w-full p-2 border border-gray-300 rounded text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="0">
                                        </div>
                                        <div>
                                            <label class="block text-sm mb-1 text-purple-200">æ°£æµ·</label>
                                            <input type="number" id="manual_qihai" class="w-full p-2 border border-gray-300 rounded text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="0">
                                        </div>
                                        <div>
                                            <label class="block text-sm mb-1 text-purple-200">èº«æ³•</label>
                                            <input type="number" id="manual_agility" class="w-full p-2 border border-gray-300 rounded text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="0">
                                        </div>
                                        <div>
                                            <label class="block text-sm mb-1 text-purple-200">æ ¹éª¨</label>
                                            <input type="number" id="manual_constitution" class="w-full p-2 border border-gray-300 rounded text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="0">
                                        </div>
                                        <div>
                                            <label class="block text-sm mb-1 text-purple-200">è€åŠ›</label>
                                            <input type="number" id="manual_endurance" class="w-full p-2 border border-gray-300 rounded text-sm stat-input bg-white bg-opacity-90 text-gray-800" value="0">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- å‚·å®³è¨ˆç®—çµæœ -->
                        <div>
                            <h3 class="text-lg font-medium mb-3 text-purple-200"><i class="fas fa-bullseye mr-2 text-red-300"></i>å‚·å®³è¨ˆç®—çµæœ</h3>
                            <div class="space-y-4">
                                <button onclick="calculateDamage()" class="w-full star-btn calc-btn">
                                    <i class="fas fa-calculator"></i> è¨ˆç®—å‚·å®³å·®ç•°
                                </button>
                                <div id="damageResults" class="space-y-3">
                                    <div class="text-center text-sm p-4 bg-white bg-opacity-20 rounded-lg text-white">
                                        <i class="fas fa-lightbulb text-purple-300 text-lg mb-2"></i>
                                        <p class="mb-1">1. è¼¸å…¥ç•¶å‰ç¸½å±¬æ€§</p>
                                        <p class="mb-1">2. é¸æ“‡ç•¶å‰è£å‚™ä¸¦è¨ˆç®—åŸºç¤é¢æ¿</p>
                                        <p class="mb-1">3. é¸æ“‡æ–°è£å‚™é…ç½®</p>
                                        <p>4. é»æ“Šè¨ˆç®—å‚·å®³å·®ç•°</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è£å‚™é…ç½®å€åŸŸ -->
            <div class="mt-8">
                <div class="card-shadow rounded-2xl p-6 card-gradient-6 card-hover">
                    <h2 class="text-xl font-semibold mb-6 section-title">ğŸ›¡ï¸ è£å‚™é…ç½®</h2>
                    
                    <div class="grid lg:grid-cols-2 gap-8">
                        <!-- ç•¶å‰ç©¿æˆ´è£å‚™ -->
                        <div>
                            <h3 class="text-lg font-medium mb-4 text-purple-200"><i class="fas fa-user mr-2"></i>ç•¶å‰ç©¿æˆ´è£å‚™</h3>
                            <div class="p-4 bg-white bg-opacity-20 rounded-lg border border-blue-200">
                                <div class="space-y-3" id="currentEquipmentSelectors">
                                    <!-- ç•¶å‰è£å‚™é¸æ“‡å™¨å°‡åœ¨é€™è£¡ç”Ÿæˆ -->
                                </div>
                                <button onclick="calculateBaseStats()" class="w-full mt-4 star-btn base-btn">
                                    <i class="fas fa-calculator"></i> è¨ˆç®—åŸºç¤é¢æ¿
                                </button>
                            </div>
                            
                            <!-- åŸºç¤é¢æ¿é¡¯ç¤º -->
                            <div class="mt-4 p-4 bg-green-500 bg-opacity-20 rounded-lg border border-green-900">
                                <h4 class="text-sm font-medium mb-3 text-purple-200">åŸºç¤é¢æ¿ (ä¸å«è£å‚™)</h4>
                                <div id="baseStatsDisplay" class="text-sm text-white">
                                    <div>è«‹å…ˆè¨ˆç®—åŸºç¤é¢æ¿</div>
                                </div>
                            </div>
                        </div>

                        <!-- æ–°è£å‚™é…ç½® -->
                        <div>
                            <h3 class="text-lg font-medium mb-4 text-purple-200"><i class="fas fa-sync-alt mr-2"></i>æ–°è£å‚™é…ç½®</h3>
                            <div class="p-4 bg-white bg-opacity-20 rounded-lg border border-purple-200">
                                <div class="space-y-3" id="newEquipmentSelectors">
                                    <!-- æ–°è£å‚™é¸æ“‡å™¨å°‡åœ¨é€™è£¡ç”Ÿæˆ -->
                                </div>
                                <button onclick="calculateNewEquipmentStats()" class="w-full mt-4 star-btn new-equip-btn">
                                    <i class="fas fa-calculator"></i> è¨ˆç®—æ–°è£å‚™å±¬æ€§
                                </button>
                            </div>
                            
                            <!-- æ–°è£å‚™å±¬æ€§é¡¯ç¤º -->
                            <div class="mt-4 p-4 bg-orange-200 bg-opacity-50 rounded-lg border border-orange-400">
                                <h4 class="text-sm font-medium mb-3 text-purple-200">æ–°è£å‚™å±¬æ€§å°æ¯” (èˆ‡ç•¶å‰è£å‚™å·®ç•°)</h4>
                                <div id="newEquipmentStatsDisplay" class="text-sm text-white">
                                    <div>è«‹å…ˆé¸æ“‡æ–°è£å‚™ä¸¦è¨ˆç®—</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å¥—è£æ•ˆæœé¡¯ç¤ºå€åŸŸ -->
            <div class="mt-4 mb-8">
                <div class="card-shadow rounded-2xl p-6 card-gradient-7 card-hover">
                    <h2 class="text-xl font-semibold mb-4 section-title">ğŸ§© è£å‚™æ•ˆæœ</h2>
                    <div class="grid lg:grid-cols-2 gap-6">
                        <!-- ç•¶å‰è£å‚™å¥—è£æ•ˆæœ -->
                        <div>
                            <h3 class="text-lg font-medium mb-3 set-effect-header text-purple-200"><i class="fas fa-tshirt mr-2"></i>ç•¶å‰è£å‚™æ•ˆæœ</h3>
                            <div id="currentSetEffects" class="p-3 bg-white bg-opacity-20 rounded-lg border border-blue-200 text-white">
                                <div class="text-sm">è«‹å…ˆé¸æ“‡è£å‚™</div>
                            </div>
                        </div>
                        
                        <!-- æ–°è£å‚™å¥—è£æ•ˆæœ -->
                        <div>
                            <h3 class="text-lg font-medium mb-3 set-effect-header text-purple-200"><i class="fas fa-tshirt mr-2"></i>æ–°è£å‚™æ•ˆæœ</h3>
                            <div id="newSetEffects" class="p-3 bg-white bg-opacity-20 rounded-lg border border-purple-200 text-white">
                                <div class="text-sm">è«‹å…ˆé¸æ“‡è£å‚™</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- äº”ç¶­å±¬æ€§è½‰æ›èªªæ˜ -->
            <div class="mt-8 mb-8">
                <div class="card-shadow rounded-2xl p-6 card-gradient-8 card-hover">
                    <h2 class="text-xl font-semibold mb-4 section-title">ğŸ“š äº”ç¶­å±¬æ€§è½‰æ›èªªæ˜</h2>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="p-4 bg-white bg-opacity-20 rounded-lg border border-amber-100">
                            <h3 class="text-lg font-medium mb-3 text-purple-200"><i class="fas fa-exchange-alt mr-2"></i>åŸºç¤è½‰æ›è¦å‰‡</h3>
                            <ul class="text-sm space-y-2 text-white">
                                <li><span class="font-medium">åŠ›é‡</span> â†’ æ”»æ“Š: 4.65, ç ´é˜²: 2.0</li>
                                <li><span class="font-medium">æ°£æµ·</span> â†’ æ”»æ“Š: 4.65, ç ´é˜²: 2.0</li>
                                <li><span class="font-medium">èº«æ³•</span> â†’ æœƒå¿ƒ: 1.6, å‘½ä¸­: 0.83</li>
                                <li><span class="font-medium">æ ¹éª¨</span> â†’ ç„¡ç›´æ¥è½‰æ›</li>
                                <li><span class="font-medium">è€åŠ›</span> â†’ ç„¡ç›´æ¥è½‰æ›</li>
                            </ul>
                        </div>
                        <div class="p-4 bg-white bg-opacity-20 rounded-lg border border-orange-100">
                            <h3 class="text-lg font-medium mb-3 text-purple-200"><i class="fas fa-user-tie mr-2"></i>è·æ¥­ç‰¹æ®Šè½‰æ›</h3>
                            <ul class="text-sm space-y-2 text-white">
                                <li><span class="font-medium">ç¥ç›¸</span>: æ°£æµ· â†’ å‘½ä¸­: 0.83</li>
                                <li><span class="font-medium">ä¹éˆ</span>: è€åŠ› â†’ æ”»æ“Š: 1.65</li>
                                <li><span class="font-medium">é¾åŸ</span>: æ ¹éª¨ â†’ ç ´é˜²: 2.0</li>
                                <li><span class="font-medium">ç¢å¤¢</span>: èº«æ³• â†’ æœƒå¿ƒ: 0.6</li>
                                <li><span class="font-medium">è¡€æ²³</span>: æ ¹éª¨ â†’ æ”»æ“Š: 1.65</li>
                                <li class="font-bold"><span class="font-medium">ç‰¹æ®Šè¦å‰‡</span>: ç•¶ä¸»è·æ¥­ç‚ºå¤–åŠŸä¸”ç‰¹è³ªç‚ºç¥ç›¸æ™‚ï¼ŒåŠ›é‡â†’å‘½ä¸­: 0.83</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- é è…³ -->
            <div class="text-center mt-12 mb-6 text-sm text-purple-300">
                <p>å‚·å®³è¨ˆç®—å™¨ v1.0 | è©¦ä½œåˆç‰ˆ</p>
                <p class="mt-2">Â© 2025 é€†æ°´å¯’å‚·å®³è¨ˆç®—å·¥å…·</p>
            </div>
        </div>
    </div>

    <div id="notification" class="notification">
        <i class="fas fa-info-circle mr-2"></i>ç•¶ä¸»è·æ¥­ç‚ºå¤–åŠŸä¸”ç‰¹è³ªç‚ºç¥ç›¸æ™‚ï¼Œå·²å•Ÿç”¨åŠ›é‡è½‰å‘½ä¸­æ•ˆæœï¼
    </div>

    <script>
        // å…¨å±€è®Šé‡å­˜å„²åŠ è¼‰çš„æ•¸æ“š
        let TARGET_PRESETS = {};
        let EQUIPMENT_PRESETS_BY_SLOT = {};
        
        // å¥—è£æ•ˆæœæ˜ å°„
        const SET_EFFECTS = {
            81: { 
                upperTwoSet: { bossDamage: 607 }, // é¦–é ˜å…‹åˆ¶
                upperFourSet: { bossDamagePercent: 0.067 }, // é¦–é ˜å…‹åˆ¶%
                lowerTwoSet: { bossDamagePercent: 0.084, critDamage: 0 }
            },
            83: { 
                upperTwoSet: { bossDamage: 619 }, 
                upperFourSet: { bossDamagePercent: 0.075 },
                lowerTwoSet: { bossDamagePercent: 0.085, critDamage: 0.04 }
            },
            85: { 
                upperTwoSet: { bossDamage: 630 }, 
                upperFourSet: { bossDamagePercent: 0.082 },
                lowerTwoSet: { bossDamagePercent: 0.087, critDamage: 0.041 }
            }
        };

        // ç¨çæ•ˆæœæ˜ å°„
        const UNIQUE_EFFECTS = {
            "è–›åŒ—é¯¤Â·å­¤é·¹è…°å¸¶": function(totalStats) {
				return {
					attack: totalStats.constitution * 1  // æ”»å‡» = æ ¹éª¨ * 1
				};
			},
			"ç‰§é‡å½Œæˆ’æŒ‡": { bossDamage: 180, crit: 100 },
			"æŸ³æ˜Ÿèé …éŠ": { bossDamagePercent: 0.06, critDamage: 0.05 },
			"å—å•é›ªæ‰‹é²": { elementalAttack: 150, armorBreak: 100 },
			"é»‘å¤©å°Šä½¿è­·è…•": { attack: 200, armorBreak: 100 },
		};

        // ä¸ŠåŠèº«éƒ¨ä½ (é©ç”¨ç™¾éŠå¥—è£æ•ˆæœ)
        const UPPER_BODY_SLOTS = ["é ­éƒ¨", "æ‰‹å¥—", "è­·è…•", "è…°å¸¶", "é‹å­"];
        
        // ä¸‹åŠèº«éƒ¨ä½ (é©ç”¨ç™¾éŠå¥—è£æ•ˆæœ)
        const LOWER_BODY_SLOTS = ["é£¾å“1", "é£¾å“2", "é …éŠ"];

        // äº”ç¶­å±¬æ€§è½‰æ›è¦å‰‡
        const FIVE_STATS_CONVERSION = {
            "åŠ›é‡": {"æ”»æ“Š": 4.65, "ç ´é˜²": 2},
            "æ°£æµ·": {"æ”»æ“Š": 4.65, "ç ´é˜²": 2},
            "èº«æ³•": {"æœƒå¿ƒ": 1.6, "å‘½ä¸­": 0.83},
            "æ ¹éª¨": {},
            "è€åŠ›": {}
        };

        // è·æ¥­åˆ†é¡
        const PROFESSION_TYPES = {
            "å…§åŠŸ": ["ç¥ç›¸", "ä¹éˆ", "ç´ å•", "é¾åŸ"],
            "å¤–åŠŸ": ["ç¢å¤¢", "éµè¡£", "è¡€æ²³"]
        };

        // è·æ¥­ç‰¹æ®Šè½‰æ›è¦å‰‡
        const PROFESSION_CONVERSION = {
            "ç¥ç›¸": {"æ°£æµ·": {"å‘½ä¸­": 0.83}},
            "ä¹éˆ": {"è€åŠ›": {"æ”»æ“Š": 1.65}},
            "ç´ å•": {},
            "é¾åŸ": {"æ ¹éª¨": {"ç ´é˜²": 2}},
            "ç¢å¤¢": {"èº«æ³•": {"æœƒå¿ƒ": 0.6}},
            "éµè¡£": {},
            "è¡€æ²³": {"æ ¹éª¨": {"æ”»æ“Š": 1.65}}
        };

        // è·æ¥­æ•ˆæœæè¿°
        const PROFESSION_EFFECTS = {
            "ç¥ç›¸": "æ¯é»æ°£æµ·é¡å¤–+0.83å‘½ä¸­",
            "ä¹éˆ": "æ¯é»è€åŠ›é¡å¤–+1.65æ”»æ“Š",
            "ç´ å•": "æš«ç„¡ç‰¹æ®Šè½‰æ›",
            "é¾åŸ": "æ¯é»æ ¹éª¨é¡å¤–+2ç ´é˜²",
            "ç¢å¤¢": "æ¯é»èº«æ³•é¡å¤–+0.6æœƒå¿ƒ",
            "éµè¡£": "æš«ç„¡ç‰¹æ®Šè½‰æ›",
            "è¡€æ²³": "æ¯é»æ ¹éª¨é¡å¤–+1.65æ”»æ“Š"
        };

        // ç•¶å‰é¸æ“‡çš„è·æ¥­
        let selectedMainProfession = "ç¥ç›¸";
        let selectedTrait = "é¾åŸ";
        let specialRuleActive = false;

        // å±¬æ€§åç¨±å°æ‡‰
        const STAT_NAMES = [
            "æ”»æ“Š", "å…ƒç´ æ”»æ“Š", "ç ´é˜²", "å¿½è¦–æŠ—æ€§", "å‘½ä¸­", "æœƒå¿ƒ", "é¦–é ˜å…‹åˆ¶", 
            "é¦–é ˜å…‹åˆ¶%", "æœƒå¿ƒå‚·å®³", "ç ´ç›¾", "åŠ›é‡", "æ°£æµ·", "èº«æ³•", "æ ¹éª¨", "è€åŠ›"
        ];

        // è£å‚™éƒ¨ä½
        const EQUIPMENT_SLOTS = [
            "é ­éƒ¨", "æ‰‹å¥—", "è­·è…•", "è…°å¸¶", "è­·ç”²", "é‹å­", 
            "æ­¦å™¨", "é£¾å“1", "é£¾å“2", "æˆ’æŒ‡1", "æˆ’æŒ‡2", "é …éŠ"
        ];

        // ç•¶å‰ç©¿æˆ´çš„è£å‚™ (ç”¨æ–¼è¨ˆç®—åŸºç¤é¢æ¿)
        let currentWearingEquipment = {};
        
        // æ–°è£å‚™é…ç½®
        let newEquipment = {};
        
        // åŸºç¤é¢æ¿å±¬æ€§ (ä¸å«è£å‚™)
        let baseStats = new Array(15).fill(0);

        // åŠ è¼‰å¤–éƒ¨JSONæ•¸æ“š
        function loadExternalData() {
            // ä½¿ç”¨Promise.allåŒæ™‚åŠ è¼‰å…©å€‹JSONæ–‡ä»¶
            Promise.all([
                fetch('targets.json').then(response => response.json()),
                fetch('equipments.json').then(response => response.json())
            ])
            .then(([targets, equipments]) => {
                TARGET_PRESETS = targets;
                EQUIPMENT_PRESETS_BY_SLOT = equipments;
                
                // éš±è—åŠ è¼‰æŒ‡ç¤ºå™¨
                document.getElementById('dataLoading').classList.add('hidden');
                // é¡¯ç¤ºæ‡‰ç”¨å…§å®¹
                document.getElementById('appContent').classList.remove('hidden');
                
                // åˆå§‹åŒ–æ‡‰ç”¨
                initializeApp();
            })
            .catch(error => {
                console.error('åŠ è¼‰æ•¸æ“šæ™‚å‡ºéŒ¯:', error);
                document.getElementById('dataLoading').innerHTML = `
                    <div class="text-center p-8">
                        <i class="fas fa-exclamation-triangle text-red-500 text-4xl mb-4"></i>
                        <p class="text-red-700 font-bold mb-2">æ•¸æ“šåŠ è¼‰å¤±æ•—</p>
                        <p class="text-gray-600 mb-4">è«‹æª¢æŸ¥JSONæ–‡ä»¶æ˜¯å¦å¯ç”¨</p>
                        <button onclick="location.reload()" class="px-4 py-2 bg-purple-600 text-white rounded-lg">
                            <i class="fas fa-sync-alt mr-2"></i>é‡æ–°åŠ è¼‰
                        </button>
                    </div>
                `;
            });
        }
        

        // åˆå§‹åŒ–æ‡‰ç”¨
        function initializeApp() {
            createCurrentEquipmentSelectors();
            createNewEquipmentSelectors();
            setupEventListeners();
            updateSetEffects('current');
            updateSetEffects('new');
            updateFiveStatsDisplay();
            updateProfessionEffects();
            updateConversionDisplay();
            populateTargetSelect();
            setupFiveStatsInputListeners();
        }

        // å¡«å……ç›®æ¨™é¸æ“‡ä¸‹æ‹‰èœå–®
        function populateTargetSelect() {
            const targetSelect = document.getElementById('targetSelect');
            targetSelect.innerHTML = '<option value="">è«‹é¸æ“‡ç›®æ¨™</option>';
            
            for (const targetName in TARGET_PRESETS) {
                const option = document.createElement('option');
                option.value = targetName;
                option.textContent = targetName;
                targetSelect.appendChild(option);
            }
            
            // è¨­ç½®é»˜èªå€¼
            if (TARGET_PRESETS.hasOwnProperty('è‹±é›„é¡å¤©é–£ç¦é–£')) {
                targetSelect.value = 'è‹±é›„é¡å¤©é–£ç¦é–£';
            }
            
            updateTargetStats();
        }

        // è¨­ç½®äº”ç¶­å±¬æ€§è¼¸å…¥ç›£è½
        function setupFiveStatsInputListeners() {
            const stats = ['strength', 'qihai', 'agility', 'constitution', 'endurance'];
            stats.forEach(stat => {
                document.getElementById(`current_${stat}`).addEventListener('input', function() {
                    updateFiveStatsDisplay();
                });
            });
        }

        // æ›´æ–°äº”ç¶­å±¬æ€§é¡¯ç¤º
        function updateFiveStatsDisplay() {
            document.getElementById('strengthValue').textContent = 
                document.getElementById('current_strength').value || '0';
            document.getElementById('qihaiValue').textContent = 
                document.getElementById('current_qihai').value || '0';
            document.getElementById('agilityValue').textContent = 
                document.getElementById('current_agility').value || '0';
            document.getElementById('constitutionValue').textContent = 
                document.getElementById('current_constitution').value || '0';
            document.getElementById('enduranceValue').textContent = 
                document.getElementById('current_endurance').value || '0';
        }

        // æ›´æ–°è½‰æ›é¡¯ç¤º
        function updateConversionDisplay() {
            const container = document.getElementById('conversionDisplay');
            
            if (!selectedMainProfession) {
                container.innerHTML = '<div class="text-center py-4 text-white"><div>è«‹é¸æ“‡è·æ¥­æŸ¥çœ‹è½‰æ›è¦å‰‡</div></div>';
                return;
            }
            
            const professionType = PROFESSION_TYPES["å…§åŠŸ"].includes(selectedMainProfession) ? "å…§åŠŸ" : "å¤–åŠŸ";
            
            let html = '';
            
            // ä¸»è·æ¥­è½‰æ›
            html += `
                <div class="conversion-card">
                    <h3 class="text-md font-medium conversion-header mb-3">ä¸»è·æ¥­: ${selectedMainProfession} (${professionType})</h3>
                    <ul class="text-sm text-white space-y-2">
            `;
            
            if (professionType === "å¤–åŠŸ") {
                html += `
                    <li><span class="font-medium">åŠ›é‡</span> â†’ æ”»æ“Š: 4.65, ç ´é˜²: 2.0</li>
                    <li><span class="font-medium">èº«æ³•</span> â†’ æœƒå¿ƒ: 1.6, å‘½ä¸­: 0.83</li>
                `;
            } else {
                html += `
                    <li><span class="font-medium">æ°£æµ·</span> â†’ æ”»æ“Š: 4.65, ç ´é˜²: 2.0</li>
                    <li><span class="font-medium">èº«æ³•</span> â†’ æœƒå¿ƒ: 1.6, å‘½ä¸­: 0.83</li>
                `;
            }
            
            // æ·»åŠ è·æ¥­ç‰¹æ®Šè½‰æ›
            if (PROFESSION_CONVERSION[selectedMainProfession]) {
                Object.keys(PROFESSION_CONVERSION[selectedMainProfession]).forEach(stat => {
                    const conversions = PROFESSION_CONVERSION[selectedMainProfession][stat];
                    Object.keys(conversions).forEach(target => {
                        html += `<li><span class="font-medium">${stat}</span> â†’ ${target}: ${conversions[target]}</li>`;
                    });
                });
            }
            
            html += `</ul></div>`;
            
            // ç‰¹è³ªè½‰æ›
            if (selectedTrait) {
                html += `
                    <div class="conversion-card">
                        <h3 class="text-md font-medium conversion-header mb-3">ç‰¹è³ª: ${selectedTrait}</h3>
                        <ul class="text-sm text-white space-y-2">
                `;
                
                // ç‰¹æ®Šè¦å‰‡ï¼šä¸»è·æ¥­ç‚ºå¤–åŠŸä¸”ç‰¹è³ªç‚ºç¥ç›¸æ™‚
                if (selectedMainProfession && PROFESSION_TYPES["å¤–åŠŸ"].includes(selectedMainProfession) && 
                    selectedTrait === "ç¥ç›¸") {
                    html += `<li><span class="font-medium">åŠ›é‡</span> â†’ å‘½ä¸­: 0.83</li>`;
                } 
                // å…¶ä»–ç‰¹è³ªè½‰æ›
                else if (PROFESSION_CONVERSION[selectedTrait]) {
                    Object.keys(PROFESSION_CONVERSION[selectedTrait]).forEach(stat => {
                        const conversions = PROFESSION_CONVERSION[selectedTrait][stat];
                        Object.keys(conversions).forEach(target => {
                            html += `<li><span class="font-medium">${stat}</span> â†’ ${target}: ${conversions[target]}</li>`;
                        });
                    });
                } else {
                    html += `<li>æš«ç„¡ç‰¹æ®Šè½‰æ›</li>`;
                }
                
                html += `</ul></div>`;
            }
            
            container.innerHTML = html;
        }

        // å‰µå»ºç•¶å‰è£å‚™é¸æ“‡å™¨
        function createCurrentEquipmentSelectors() {
            const container = document.getElementById('currentEquipmentSelectors');
            container.innerHTML = '';

            EQUIPMENT_SLOTS.forEach(slot => {
                // ç¢ºä¿è©²è£å‚™æ§½ä½å­˜åœ¨æ–¼æ•¸æ“šä¸­
                if (!EQUIPMENT_PRESETS_BY_SLOT[slot]) {
                    console.warn(`æœªæ‰¾åˆ°æ§½ä½ ${slot} çš„è£å‚™æ•¸æ“š`);
                    return;
                }
                
                const div = document.createElement('div');
                div.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <label class="text-sm w-16 font-medium text-purple-200">${slot}</label>
                        <select id="current_equipment_${slot}" class="flex-1 p-2 border border-blue-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white bg-opacity-90 text-gray-800
">
                            ${Object.keys(EQUIPMENT_PRESETS_BY_SLOT[slot]).map(item => 
                                `<option value="${item}">${item}</option>`
                            ).join('')}
                        </select>
                    </div>
                `;
                container.appendChild(div);

                // è¨­ç½®äº‹ä»¶ç›£è½å™¨
                const select = div.querySelector('select');
                select.addEventListener('change', () => {
                    currentWearingEquipment[slot] = select.value;
                    updateSetEffects('current');
                });

                // åˆå§‹åŒ–é¸æ“‡
                const defaultItem = slot === "æ­¦å™¨" ? "83ç™¾éŠæ­¦å™¨" : 
                                  slot === "è­·ç”²" ? "81æŸ³æ˜Ÿèâ€§é»¯æœˆå­¤ç…§è¢" : 
                                  Object.keys(EQUIPMENT_PRESETS_BY_SLOT[slot])[1];
                select.value = defaultItem;
                currentWearingEquipment[slot] = defaultItem;
            });
        }

        // å‰µå»ºæ–°è£å‚™é¸æ“‡å™¨
        function createNewEquipmentSelectors() {
            const container = document.getElementById('newEquipmentSelectors');
            container.innerHTML = '';

            EQUIPMENT_SLOTS.forEach(slot => {
                // ç¢ºä¿è©²è£å‚™æ§½ä½å­˜åœ¨æ–¼æ•¸æ“šä¸­
                if (!EQUIPMENT_PRESETS_BY_SLOT[slot]) {
                    console.warn(`æœªæ‰¾åˆ°æ§½ä½ ${slot} çš„è£å‚™æ•¸æ“š`);
                    return;
                }
                
                const div = document.createElement('div');
                div.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <label class="text-sm w-16 font-medium text-purple-200">${slot}</label>
                        <select id="new_equipment_${slot}" class="flex-1 p-2 border border-purple-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white bg-opacity-90 text-gray-800">
                            ${Object.keys(EQUIPMENT_PRESETS_BY_SLOT[slot]).map(item => 
                                `<option value="${item}">${item}</option>`
                            ).join('')}
                        </select>
                    </div>
                `;
                container.appendChild(div);

                // è¨­ç½®äº‹ä»¶ç›£è½å™¨
                const select = div.querySelector('select');
                select.addEventListener('change', () => {
                    newEquipment[slot] = select.value;
                    updateSetEffects('new');
                });

                // åˆå§‹åŒ–é¸æ“‡
                const defaultItem = slot === "æ­¦å™¨" ? "85ç™¾éŠæ­¦å™¨" : 
                                  slot === "è­·ç”²" ? "æç™½å¤©åœ°å…‰é™°è¢" : 
                                  Object.keys(EQUIPMENT_PRESETS_BY_SLOT[slot])[1];
                select.value = defaultItem;
                newEquipment[slot] = defaultItem;
            });
        }

        // è¨­ç½®äº‹ä»¶ç›£è½å™¨
        function setupEventListeners() {
            document.getElementById('targetSelect').addEventListener('change', function() {
                updateTargetStats();
            });
            
            document.getElementById('mainProfessionSelect').addEventListener('change', function() {
                selectedMainProfession = this.value;
                updateProfessionEffects();
                updateConversionDisplay();
                checkSpecialRule();
            });
            
            document.getElementById('traitSelect').addEventListener('change', function() {
                selectedTrait = this.value;
                updateProfessionEffects();
                updateConversionDisplay();
                checkSpecialRule();
            });
        }
        
        // æª¢æŸ¥ç‰¹æ®Šè¦å‰‡
        function checkSpecialRule() {
            const notification = document.getElementById('notification');
            specialRuleActive = false;
            
            if (selectedMainProfession && PROFESSION_TYPES["å¤–åŠŸ"].includes(selectedMainProfession) && 
                selectedTrait === "ç¥ç›¸") {
                specialRuleActive = true;
                notification.classList.add('show');
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
        }

        // æ›´æ–°ç›®æ¨™å±¬æ€§é¡¯ç¤º
        function updateTargetStats() {
            const targetSelect = document.getElementById('targetSelect');
            const targetStatsDiv = document.getElementById('targetStats');
            const selectedTarget = targetSelect.value;

            if (!selectedTarget || !TARGET_PRESETS[selectedTarget]) {
                targetStatsDiv.innerHTML = '<div class="flex items-center justify-center h-24"><i class="fas fa-crosshairs mr-2"></i>è«‹å…ˆé¸æ“‡ç›®æ¨™</div>';
                return;
            }

            const stats = TARGET_PRESETS[selectedTarget];
            targetStatsDiv.innerHTML = `
                <div class="grid grid-cols-2 gap-2 text-white">
                    <div>é˜²ç¦¦: <span class="font-medium">${stats.defense}</span></div>
                    <div>å…ƒç´ æŠ—æ€§: <span class="font-medium">${stats.elemental_resist}</span></div>
                    <div>æ ¼æ“‹: <span class="font-medium">${stats.block}</span></div>
                    <div>æœƒå¿ƒæŠ—æ€§: <span class="font-medium">${stats.crit_resist}</span></div>
                    <div>æŠµç¦¦: <span class="font-medium">${stats.defense_base}</span></div>
                    <div>æ°£ç›¾: <span class="font-medium">${stats.shield_base}</span></div>
                </div>
            `;
        }

        // æ›´æ–°è·æ¥­æ•ˆæœé¡¯ç¤º
        function updateProfessionEffects() {
            const effectsDiv = document.getElementById('professionEffects');
            
            if (!selectedMainProfession && !selectedTrait) {
                effectsDiv.innerHTML = '<div class="flex items-center justify-center h-full text-white"><i class="fas fa-info-circle mr-2"></i>è«‹é¸æ“‡è·æ¥­æŸ¥çœ‹æ•ˆæœ</div>';
                return;
            }
            
            let effectsHtml = '<div class="space-y-2 text-white">';
            
            if (selectedMainProfession) {
                const professionType = PROFESSION_TYPES["å…§åŠŸ"].includes(selectedMainProfession) ? "å…§åŠŸ" : "å¤–åŠŸ";
                effectsHtml += `
                    <div class="text-sm">
                        <span class="font-medium">ä¸»è·æ¥­:</span> ${selectedMainProfession} (${professionType})
                        <div class="text-xs ml-2">${PROFESSION_EFFECTS[selectedMainProfession]}</div>
                    </div>
                `;
            }
            
            if (selectedTrait) {
                const traitType = PROFESSION_TYPES["å…§åŠŸ"].includes(selectedTrait) ? "å…§åŠŸ" : "å¤–åŠŸ";
                
                // ç‰¹æ®Šè¦å‰‡é¡¯ç¤º
                let traitEffect = PROFESSION_EFFECTS[selectedTrait];
                if (specialRuleActive) {
                    traitEffect = "æ¯é»åŠ›é‡é¡å¤–+0.83å‘½ä¸­";
                }
                
                effectsHtml += `
                    <div class="text-sm">
                        <span class="font-medium">ç‰¹è³ª:</span> ${selectedTrait} (${traitType})
                        <div class="text-xs ml-2">${traitEffect}</div>
                    </div>
                `;
            }
            
            // é¡¯ç¤ºæœ‰æ•ˆäº”ç¶­å±¬æ€§
            if (selectedMainProfession) {
                const professionType = PROFESSION_TYPES["å…§åŠŸ"].includes(selectedMainProfession) ? "å…§åŠŸ" : "å¤–åŠŸ";
                const validStats = professionType === "å…§åŠŸ" ? "æ°£æµ·ã€èº«æ³•ã€æ ¹éª¨ã€è€åŠ›" : "åŠ›é‡ã€èº«æ³•ã€æ ¹éª¨ã€è€åŠ›";
                effectsHtml += `
                    <div class="text-xs mt-2 pt-2 border-t">
                        æœ‰æ•ˆäº”ç¶­å±¬æ€§: ${validStats}
                    </div>
                `;
            }
            
            effectsHtml += '</div>';
            effectsDiv.innerHTML = effectsHtml;
        }

        // ä¿®å¾©çš„å¥—è£æ•ˆæœè¨ˆç®—å‡½æ•¸ï¼ˆæ”¯æŒå‘ä¸‹å…¼å®¹ï¼‰
        function calculateSetEffects(equipmentConfig) {
            const setEffects = {
                upperSet: { level: null, count: 0, effects: [] },
                lowerSet: { level: null, count: 0, effects: [] },
                uniqueEffects: [] // æ–°å¢ï¼šå­˜å„²æ‰€æœ‰ç¨çæ•ˆæœ
            };
            
            // ä¸ŠåŠèº«ç™¾éŠè£å‚™ç­‰ç´šåˆ—è¡¨
            const upperItems = [];
            UPPER_BODY_SLOTS.forEach(slot => {
                const itemName = equipmentConfig[slot];
                if (itemName && (itemName.includes('81ç™¾éŠ') || itemName.includes('83ç™¾éŠ') || itemName.includes('85ç™¾éŠ'))) {
                    if (itemName.includes('81ç™¾éŠ')) upperItems.push(81);
                    else if (itemName.includes('83ç™¾éŠ')) upperItems.push(83);
                    else if (itemName.includes('85ç™¾éŠ')) upperItems.push(85);
                }
                
                // æª¢æŸ¥æ˜¯å¦ç‚ºç¨çè£å‚™
                if (itemName && UNIQUE_EFFECTS[itemName]) {
                    setEffects.uniqueEffects.push({
                        name: itemName,
                        effect: UNIQUE_EFFECTS[itemName]
                    });
                }
            });
            
            // ä¿®å¾©çš„é‚è¼¯ï¼šåˆ†åˆ¥è¨ˆç®—å…©ä»¶å¥—å’Œå››ä»¶å¥—æ•ˆæœï¼ˆå‘ä¸‹å…¼å®¹ï¼‰
            if (upperItems.length > 0) {
                // å…©ä»¶å¥—æ•ˆæœï¼šå–å¯æ¿€æ´»çš„æœ€é«˜ç­‰ç´š
                const sortedUpper = [...upperItems].sort((a, b) => b - a); // é™åºæ’åº
                let twoSetLevel = null;
                for (const level of [85, 83, 81]) {
                    if (sortedUpper.filter(itemLevel => itemLevel >= level).length >= 2) {
                        twoSetLevel = level;
                        break;
                    }
                }
                
                // å››ä»¶å¥—æ•ˆæœï¼šå–å¯æ¿€æ´»çš„æœ€é«˜ç­‰ç´š
                let fourSetLevel = null;
                for (const level of [85, 83, 81]) {
                    if (sortedUpper.filter(itemLevel => itemLevel >= level).length >= 4) {
                        fourSetLevel = level;
                        break;
                    }
                }
                
                // æ‡‰ç”¨æ•ˆæœ
                if (twoSetLevel) {
                    setEffects.upperSet.effects.push({
                        name: "2ä»¶å¥—æ•ˆæœ",
                        value: `é¦–é ˜å…‹åˆ¶ +${SET_EFFECTS[twoSetLevel].upperTwoSet.bossDamage}`,
                        level: twoSetLevel
                    });
                }
                
                if (fourSetLevel) {
                    setEffects.upperSet.effects.push({
                        name: "4ä»¶å¥—æ•ˆæœ",
                        value: `é¦–é ˜å…‹åˆ¶ +${(SET_EFFECTS[fourSetLevel].upperFourSet.bossDamagePercent * 100).toFixed(1)}%`,
                        level: fourSetLevel
                    });
                }
            }
            
            // çµ±è¨ˆä¸‹åŠèº«å¥—è£ï¼ˆæ”¯æŒå‘ä¸‹å…¼å®¹ï¼‰
            const lowerItems = [];
            LOWER_BODY_SLOTS.forEach(slot => {
                const itemName = equipmentConfig[slot];
                if (itemName && (itemName.includes('81ç™¾éŠ') || itemName.includes('83ç™¾éŠ') || itemName.includes('85ç™¾éŠ'))) {
                    if (itemName.includes('81ç™¾éŠ')) lowerItems.push(81);
                    else if (itemName.includes('83ç™¾éŠ')) lowerItems.push(83);
                    else if (itemName.includes('85ç™¾éŠ')) lowerItems.push(85);
                }
                
                // æª¢æŸ¥æ˜¯å¦ç‚ºç¨çè£å‚™
                if (itemName && UNIQUE_EFFECTS[itemName]) {
                    setEffects.uniqueEffects.push({
                        name: itemName,
                        effect: UNIQUE_EFFECTS[itemName]
                    });
                }
            });
            
            // ä¸‹åŠèº«åªæœ‰å…©ä»¶å¥—æ•ˆæœ
            if (lowerItems.length > 0) {
                // å…©ä»¶å¥—æ•ˆæœï¼šå–å¯æ¿€æ´»çš„æœ€é«˜ç­‰ç´š
                const sortedLower = [...lowerItems].sort((a, b) => b - a); // é™åºæ’åº
                let twoSetLevel = null;
                for (const level of [85, 83, 81]) {
                    if (sortedLower.filter(itemLevel => itemLevel >= level).length >= 2) {
                        twoSetLevel = level;
                        break;
                    }
                }
                
                // æ‡‰ç”¨æ•ˆæœ
                if (twoSetLevel) {
                    setEffects.lowerSet.effects.push({
                        name: "2ä»¶å¥—æ•ˆæœ",
                        value: `é¦–é ˜å…‹åˆ¶ +${(SET_EFFECTS[twoSetLevel].lowerTwoSet.bossDamagePercent * 100).toFixed(1)}%, æœƒå¿ƒå‚·å®³ +${(SET_EFFECTS[twoSetLevel].lowerTwoSet.critDamage * 100).toFixed(1)}%`,
                        level: twoSetLevel
                    });
                }
            }
            
            return setEffects;
        }
        
        // æ‡‰ç”¨å¥—è£æ•ˆæœåˆ°å±¬æ€§
        /**
        * å¥—ç”¨ã€Œç¨çï¼å¥—è£ã€æ•ˆæœåˆ° stats é™£åˆ—ã€‚
        * æ”¯æ´ï¼š
        *   â€¢ éœæ…‹æ•ˆæœ â†’ ç”¨ç‰©ä»¶æè¿° (ä¾‹å¦‚ { attack:200, bossDamage:150 })
        *   â€¢ å‡½å¼æ•ˆæœ â†’ (statsArr, totalsObj) => { ... } å…§è‡ªè¡Œå° statsArr åŠ å€¼
        *
        * @param {number[]} stats       é•·åº¦ 15 çš„å±¬æ€§é™£åˆ—ï¼Œç›´æ¥å°±åœ°ä¿®æ”¹
        * @param {Object}   setEffects  ç”± getSelectedSetEffects() å›å‚³ï¼Œ
        *                               éœ€è‡³å°‘å« uniqueEffects: string[]  
        * @param {Object}   totals      buildTotalStatsObject() ç”¢ç”Ÿçš„ç¸½å±¬æ€§ç‰©ä»¶
        */
        function applySetEffects(stats, setEffects, totals) {
			if (!setEffects || !Array.isArray(setEffects.uniqueEffects)) return;

			setEffects.uniqueEffects.forEach(unique => {
				const effectDef = unique.effect;
				if (!effectDef) return;
        
				// å‡½æ•¸å‹æ•ˆæœ - å‚³å…¥ç¸½å±¬æ€§ç‰©ä»¶
				if (typeof effectDef === 'function') {
					// ç¢ºä¿å‚³å…¥çš„ totals ç‰©ä»¶åŒ…å«æ‰€æœ‰äº”ç¶­å±¬æ€§
					const totalsWithDefaults = {
						strength: totals?.strength || 0,
						qihai: totals?.qihai || 0,
						agility: totals?.agility || 0,
						constitution: totals?.constitution || 0,
						endurance: totals?.endurance || 0
					};
					const effectResult = effectDef(totalsWithDefaults);
            
					// æ‡‰ç”¨å‡½æ•¸è¿”å›çš„æ•ˆæœ
					if (effectResult) {
						for (const stat in effectResult) {
							const value = effectResult[stat];
							switch(stat) {
								case 'attack': stats[0] += value; break;
								case 'elementalAttack': stats[1] += value; break;
								case 'armorBreak': stats[2] += value; break;
								case 'ignoreResist': stats[3] += value; break;
								case 'hit': stats[4] += value; break;
								case 'crit': stats[5] += value; break;
								case 'bossDamage': stats[6] += value; break;
								case 'bossDamagePercent': stats[7] += value; break;
								case 'critDamage': stats[8] += value; break;
								case 'shieldBreak': stats[9] += value; break;
							}
						}
					}
				} 
				// ç‰©ä»¶å‹æ•ˆæœ
				else if (typeof effectDef === 'object') {
					if (effectDef.attack) stats[0] += effectDef.attack;
					if (effectDef.elementalAttack) stats[1] += effectDef.elementalAttack;
					if (effectDef.armorBreak) stats[2] += effectDef.armorBreak;
					if (effectDef.ignoreResist) stats[3] += effectDef.ignoreResist;
					if (effectDef.hit) stats[4] += effectDef.hit;
					if (effectDef.crit) stats[5] += effectDef.crit;
					if (effectDef.bossDamage) stats[6] += effectDef.bossDamage;
					if (effectDef.bossDamagePercent) stats[7] += effectDef.bossDamagePercent;
					if (effectDef.critDamage) stats[8] += effectDef.critDamage;
					if (effectDef.shieldBreak) stats[9] += effectDef.shieldBreak;
				}
			});
		}
        
        // æ›´æ–°å¥—è£æ•ˆæœé¡¯ç¤º - ä¿®å¾©äº†éŒ¯èª¤é¡¯ç¤ºå•é¡Œ
        function updateSetEffects(type) {
            const containerId = type === 'current' ? 'currentSetEffects' : 'newSetEffects';
            const equipmentConfig = type === 'current' ? currentWearingEquipment : newEquipment;
            
            const setEffects = calculateSetEffects(equipmentConfig);
            let html = '';
            
            // ä¸ŠåŠèº«å¥—è£æ•ˆæœ
            if (setEffects.upperSet.effects.length > 0) {
                setEffects.upperSet.effects.forEach(effect => {
                    const levelClass = `level-${effect.level}`;
                    html += `
                        <div class="mb-3 p-3 bg-white bg-opacity-20 rounded-lg border border-blue-100">
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-white">${effect.name}</span>
                                <span class="level-badge ${levelClass}">${effect.level}ç´š</span>
                            </div>
                            <div class="mt-1 text-sm text-white">${effect.value}</div>
                        </div>
                    `;
                });
            } else {
                html += `<div class="text-sm mb-2 text-white"><i class="fas fa-times-circle text-red-500 mr-1"></i>ç„¡ç™¾éŠå¥—è£æ•ˆæœ</div>`;
            }
            
            // ä¸‹åŠèº«å¥—è£æ•ˆæœ
            if (setEffects.lowerSet.effects.length > 0) {
                setEffects.lowerSet.effects.forEach(effect => {
                    const levelClass = `level-${effect.level}`;
                    html += `
                        <div class="mb-3 p-3 bg-white bg-opacity-20 rounded-lg border border-purple-100">
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-white">${effect.name}</span>
                                <span class="level-badge ${levelClass}">${effect.level}ç´š</span>
                            </div>
                            <div class="mt-1 text-sm text-white">${effect.value}</div>
                        </div>
                    `;
                });
            } else {
                html += `<div class="text-sm text-white"><i class="fas fa-times-circle text-red-500 mr-1"></i>ç„¡ç™¾éŠé£¾å“å¥—è£æ•ˆæœ</div>`;
            }
            
            // ç¨çæ•ˆæœé¡¯ç¤º
            if (setEffects.uniqueEffects.length > 0) {
                html += `<div class="mt-4 pt-4 border-t border-gray-200"><h4 class="font-medium mb-2 text-white">ç¨çæ•ˆæœ</h4>`;
                setEffects.uniqueEffects.forEach(unique => {
                    let effectText = '';
                    const effect = unique.effect;
                    
                    if (effect.attack) effectText += `æ”»æ“Š +${effect.attack}, `;
                    if (effect.elementalAttack) effectText += `å…ƒç´ æ”»æ“Š +${effect.elementalAttack}, `;
                    if (effect.armorBreak) effectText += `ç ´é˜² +${effect.armorBreak}, `;
                    if (effect.ignoreResist) effectText += `å¿½è¦–æŠ—æ€§ +${effect.ignoreResist}, `;
                    if (effect.hit) effectText += `å‘½ä¸­ +${effect.hit}, `;
                    if (effect.crit) effectText += `æœƒå¿ƒ +${effect.crit}, `;
                    if (effect.bossDamage) effectText += `é¦–é ˜å…‹åˆ¶ +${effect.bossDamage}, `;
                    if (effect.bossDamagePercent) effectText += `é¦–é ˜å…‹åˆ¶ +${(effect.bossDamagePercent * 100).toFixed(1)}%, `;
                    if (effect.critDamage) effectText += `æœƒå¿ƒå‚·å®³ +${(effect.critDamage * 100).toFixed(1)}%, `;
                    if (effect.shieldBreak) effectText += `ç ´ç›¾ +${effect.shieldBreak}, `;
                    
                    // å»æ‰æœ€å¾Œçš„é€—è™Ÿå’Œç©ºæ ¼
                    if (effectText.length > 0) {
                        effectText = effectText.slice(0, -2);
                    }
                    
                    html += `
                        <div class="mb-3 p-3 bg-white bg-opacity-20 rounded-lg border border-yellow-200">
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-white">${unique.name}</span>
                                <span class="unique-badge">ç¨ç</span>
                            </div>
                            <div class="mt-1 text-sm text-white">${effectText}</div>
                        </div>
                    `;
                });
                html += `</div>`;
            } else {
                html += `<div class="mt-4 pt-4 border-t border-gray-200 text-sm text-white"><i class="fas fa-times-circle text-red-500 mr-1"></i>ç„¡ç¨çæ•ˆæœ</div>`;
            }
            
            document.getElementById(containerId).innerHTML = html;
        }

        // æ‡‰ç”¨äº”ç¶­å±¬æ€§è½‰æ›
        function applyFiveStatsConversion(stats) {
            // æª¢æŸ¥æ˜¯å¦é¸æ“‡äº†ä¸»è·æ¥­
            if (!selectedMainProfession) {
                return; // å¦‚æœæ²’æœ‰é¸æ“‡è·æ¥­ï¼Œä¸é€²è¡Œè½‰æ›
            }
            
            const professionType = PROFESSION_TYPES["å…§åŠŸ"].includes(selectedMainProfession) ? "å…§åŠŸ" : "å¤–åŠŸ";
            
            const strength = stats[10]; // åŠ›é‡
            const qihai = stats[11]; // æ°£æµ·
            const agility = stats[12]; // èº«æ³•
            const constitution = stats[13]; // æ ¹éª¨
            const endurance = stats[14]; // è€åŠ›

            // åŸºç¤äº”ç¶­è½‰æ›ï¼ˆæ ¹æ“šè·æ¥­é¡å‹ï¼‰
            if (professionType === "å¤–åŠŸ") {
                // å¤–åŠŸè·æ¥­ï¼šåŠ›é‡ã€èº«æ³•ã€æ ¹éª¨ã€è€åŠ›
                if (strength > 0) {
                    stats[0] += strength * FIVE_STATS_CONVERSION["åŠ›é‡"]["æ”»æ“Š"]; // æ”»æ“Š
                    stats[2] += strength * FIVE_STATS_CONVERSION["åŠ›é‡"]["ç ´é˜²"]; // ç ´é˜²
                }
            } else {
                // å…§åŠŸè·æ¥­ï¼šæ°£æµ·ã€èº«æ³•ã€æ ¹éª¨ã€è€åŠ›
                if (qihai > 0) {
                    stats[0] += qihai * FIVE_STATS_CONVERSION["æ°£æµ·"]["æ”»æ“Š"]; // æ”»æ“Š
                    stats[2] += qihai * FIVE_STATS_CONVERSION["æ°£æµ·"]["ç ´é˜²"]; // ç ´é˜²
                }
            }

            // èº«æ³•è½‰æ›ï¼ˆæ‰€æœ‰è·æ¥­éƒ½æœ‰ï¼‰
            if (agility > 0) {
                stats[5] += agility * FIVE_STATS_CONVERSION["èº«æ³•"]["æœƒå¿ƒ"]; // æœƒå¿ƒ
                stats[4] += agility * FIVE_STATS_CONVERSION["èº«æ³•"]["å‘½ä¸­"]; // å‘½ä¸­
            }

            // æ‡‰ç”¨ä¸»è·æ¥­ç‰¹æ®Šè½‰æ›
            applyProfessionConversion(stats, selectedMainProfession);
            
            // æ‡‰ç”¨ç‰¹è³ªè½‰æ›
            if (selectedTrait) {
                applyProfessionConversion(stats, selectedTrait, true);
            }
        }

        // æ‡‰ç”¨è·æ¥­ç‰¹æ®Šè½‰æ›
        function applyProfessionConversion(stats, profession, isTrait = false) {
            if (!profession) {
                return;
            }
            
            let conversions = PROFESSION_CONVERSION[profession];
            
            // ç‰¹æ®Šè¦å‰‡è™•ç†ï¼šä¸»è·æ¥­ç‚ºå¤–åŠŸä¸”ç‰¹è³ªç‚ºç¥ç›¸æ™‚
            if (isTrait && selectedMainProfession && PROFESSION_TYPES["å¤–åŠŸ"].includes(selectedMainProfession) && 
                profession === "ç¥ç›¸") {
                conversions = {"åŠ›é‡": {"å‘½ä¸­": 0.83}};
            }
            
            if (!conversions) {
                return;
            }
            
            Object.keys(conversions).forEach(statName => {
                let statIndex;
                switch(statName) {
                    case "åŠ›é‡": statIndex = 10; break;
                    case "æ°£æµ·": statIndex = 11; break;
                    case "èº«æ³•": statIndex = 12; break;
                    case "æ ¹éª¨": statIndex = 13; break;
                    case "è€åŠ›": statIndex = 14; break;
                    default: return;
                }
                
                const statValue = stats[statIndex];
                if (statValue > 0) {
                    const targetStats = conversions[statName];
                    Object.keys(targetStats).forEach(targetStat => {
                        let targetIndex;
                        switch(targetStat) {
                            case "æ”»æ“Š": targetIndex = 0; break;
                            case "ç ´é˜²": targetIndex = 2; break;
                            case "å‘½ä¸­": targetIndex = 4; break;
                            case "æœƒå¿ƒ": targetIndex = 5; break;
                            default: return;
                        }
                        
                        stats[targetIndex] += statValue * targetStats[targetStat];
                    });
                }
            });
        }

        // è¨ˆç®—åŸºç¤é¢æ¿
        function calculateBaseStats() {
            // ç²å–ç•¶å‰ç¸½å±¬æ€§ï¼ˆåŒ…å«äº”ç¶­è½‰æ›å¾Œçš„çµæœï¼‰
            const currentTotalStats = {
                attack: parseFloat(document.getElementById('current_attack').value) || 0,
                elementalAttack: parseFloat(document.getElementById('current_elemental_attack').value) || 0,
                armorBreak: parseFloat(document.getElementById('current_armor_break').value) || 0,
                ignoreResist: parseFloat(document.getElementById('current_ignore_resist').value) || 0,
                hit: parseFloat(document.getElementById('current_hit').value) || 0,
                crit: parseFloat(document.getElementById('current_crit').value) || 0,
                bossDamage: parseFloat(document.getElementById('current_boss_damage').value) || 0,
                bossDamagePercent: parseFloat(document.getElementById('current_boss_damage_percent').value) || 0,
                critDamage: parseFloat(document.getElementById('current_crit_damage').value) || 0,
                shieldBreak: parseFloat(document.getElementById('current_shield_break').value) || 0,
                strength: parseFloat(document.getElementById('current_strength').value) || 0,
                qihai: parseFloat(document.getElementById('current_qihai').value) || 0,
                agility: parseFloat(document.getElementById('current_agility').value) || 0,
                constitution: parseFloat(document.getElementById('current_constitution').value) || 0,
                endurance: parseFloat(document.getElementById('current_endurance').value) || 0
            };
            
            // è¨ˆç®—ç•¶å‰ç©¿æˆ´è£å‚™çš„å±¬æ€§
            const currentEquipmentStats = new Array(15).fill(0);
            
            EQUIPMENT_SLOTS.forEach(slot => {
                const selectedItem = currentWearingEquipment[slot];
                if (selectedItem && EQUIPMENT_PRESETS_BY_SLOT[slot][selectedItem]) {
                    const itemStats = EQUIPMENT_PRESETS_BY_SLOT[slot][selectedItem];
                    for (let i = 0; i < itemStats.length; i++) {
                        currentEquipmentStats[i] += itemStats[i];
                    }
                }
            });
            
            // è¨ˆç®—å¥—è£æ•ˆæœ
            const currentSetEffects = calculateSetEffects(currentWearingEquipment);
			
			const totalFiveStats = {
				strength: currentTotalStats.strength,
				qihai:    currentTotalStats.qihai,
				agility:  currentTotalStats.agility,
				constitution: currentTotalStats.constitution,  // 120 â†’ æ”»æ“ŠåŠ æˆæ­£ç¢º
				endurance:    currentTotalStats.endurance
			};
                     
            // æ‡‰ç”¨å¥—è£æ•ˆæœåˆ°è£å‚™å±¬æ€§
            applySetEffects(currentEquipmentStats, currentSetEffects, totalFiveStats);
            
            // æ‡‰ç”¨äº”ç¶­å±¬æ€§è½‰æ›
            applyFiveStatsConversion(currentEquipmentStats);
            
            // è¨ˆç®—åŸºç¤é¢æ¿ = ç•¶å‰ç¸½å±¬æ€§ - ç•¶å‰è£å‚™å±¬æ€§
            baseStats[0] = currentTotalStats.attack - currentEquipmentStats[0]; // æ”»æ“Š
            baseStats[1] = currentTotalStats.elementalAttack - currentEquipmentStats[1]; // å…ƒç´ æ”»æ“Š
            baseStats[2] = currentTotalStats.armorBreak - currentEquipmentStats[2]; // ç ´é˜²
            baseStats[3] = currentTotalStats.ignoreResist - currentEquipmentStats[3]; // å¿½è¦–æŠ—æ€§
            baseStats[4] = currentTotalStats.hit - currentEquipmentStats[4]; // å‘½ä¸­
            baseStats[5] = currentTotalStats.crit - currentEquipmentStats[5]; // æœƒå¿ƒ
            baseStats[6] = currentTotalStats.bossDamage - currentEquipmentStats[6]; // é¦–é ˜å…‹åˆ¶
            baseStats[7] = (currentTotalStats.bossDamagePercent / 100) - currentEquipmentStats[7]; // é¦–é ˜å…‹åˆ¶% (è½‰æ›ç‚ºå°æ•¸)
            baseStats[8] = (currentTotalStats.critDamage / 100) - currentEquipmentStats[8]; // æœƒå¿ƒå‚·å®³% (è½‰æ›ç‚ºå°æ•¸)
            baseStats[9] = currentTotalStats.shieldBreak - currentEquipmentStats[9]; // ç ´ç›¾
            baseStats[10] = currentTotalStats.strength - currentEquipmentStats[10]; // åŠ›é‡
            baseStats[11] = currentTotalStats.qihai - currentEquipmentStats[11]; // æ°£æµ·
            baseStats[12] = currentTotalStats.agility - currentEquipmentStats[12]; // èº«æ³•
            baseStats[13] = currentTotalStats.constitution - currentEquipmentStats[13]; // æ ¹éª¨
            baseStats[14] = currentTotalStats.endurance - currentEquipmentStats[14]; // è€åŠ›
            
            // é¡¯ç¤ºåŸºç¤é¢æ¿
            displayBaseStats();
        }
        
        // é¡¯ç¤ºåŸºç¤é¢æ¿
        function displayBaseStats() {
            const baseStatsDiv = document.getElementById('baseStatsDisplay');
            
            const statLabels = [
                'æ”»æ“Š', 'å…ƒç´ æ”»æ“Š', 'ç ´é˜²', 'å¿½è¦–æŠ—æ€§', 'å‘½ä¸­', 'æœƒå¿ƒ', 'é¦–é ˜å…‹åˆ¶', 
                'é¦–é ˜å…‹åˆ¶%', 'æœƒå¿ƒå‚·å®³', 'ç ´ç›¾', 'åŠ›é‡', 'æ°£æµ·', 'èº«æ³•', 'æ ¹éª¨', 'è€åŠ›'
            ];
            
            let html = '<div class="grid grid-cols-2 gap-1">';
            for (let i = 0; i < 15; i++) {
                const value = i === 7 || i === 8 ? 
                    `${(baseStats[i] * 100).toFixed(2)}%` : 
                    Math.round(baseStats[i]);
                html += `<div class="text-xs">${statLabels[i]}: <span class="font-medium">${value}</span></div>`;
            }
            html += '</div>';
            
            baseStatsDiv.innerHTML = html;
            
            // æ·»åŠ å‹•ç•«æ•ˆæœ
            baseStatsDiv.classList.add('fade-in');
            setTimeout(() => {
                baseStatsDiv.classList.remove('fade-in');
            }, 500);
        }
        
        // è¨ˆç®—æ–°è£å‚™å±¬æ€§
        function calculateNewEquipmentStats() {
            // è¨ˆç®—æ–°è£å‚™çš„å±¬æ€§
            const newEquipmentStats = new Array(15).fill(0);
            
            EQUIPMENT_SLOTS.forEach(slot => {
                const selectedItem = newEquipment[slot];
                if (selectedItem && EQUIPMENT_PRESETS_BY_SLOT[slot][selectedItem]) {
                    const itemStats = EQUIPMENT_PRESETS_BY_SLOT[slot][selectedItem];
                    for (let i = 0; i < itemStats.length; i++) {
                        newEquipmentStats[i] += itemStats[i];
                    }
                }
            });
            
            // è¨ˆç®—å¥—è£æ•ˆæœ
            const newSetEffects = calculateSetEffects(newEquipment);
			
			// è¨ˆç®—äº”ç¶­ç¸½å€¼ï¼ˆåŸºç¤é¢æ¿ + æ–°è£å‚™ï¼‰
			const totalFiveStats = {
				strength: baseStats[10] + newEquipmentStats[10],
				qihai: baseStats[11] + newEquipmentStats[11],
				agility: baseStats[12] + newEquipmentStats[12],
				constitution: baseStats[13] + newEquipmentStats[13],
				endurance: baseStats[14] + newEquipmentStats[14]
			};
            
            // æ‡‰ç”¨å¥—è£æ•ˆæœåˆ°è£å‚™å±¬æ€§
            applySetEffects(newEquipmentStats, newSetEffects, totalFiveStats);
			
            
            // æ‡‰ç”¨äº”ç¶­å±¬æ€§è½‰æ›
            applyFiveStatsConversion(newEquipmentStats);
            
            // é¡¯ç¤ºæ–°è£å‚™å±¬æ€§
            displayNewEquipmentStats(newEquipmentStats);
        }
        
        // é¡¯ç¤ºæ–°è£å‚™å±¬æ€§
        function displayNewEquipmentStats(stats) {
            const newEquipmentStatsDiv = document.getElementById('newEquipmentStatsDisplay');
            
            // è¨ˆç®—ç•¶å‰è£å‚™å±¬æ€§ç”¨æ–¼å°æ¯”
            const currentEquipmentStats = new Array(15).fill(0);
            
            EQUIPMENT_SLOTS.forEach(slot => {
                const selectedItem = currentWearingEquipment[slot];
                if (selectedItem && EQUIPMENT_PRESETS_BY_SLOT[slot][selectedItem]) {
                    const itemStats = EQUIPMENT_PRESETS_BY_SLOT[slot][selectedItem];
                    for (let i = 0; i < itemStats.length; i++) {
                        currentEquipmentStats[i] += itemStats[i];
                    }
                }
            });
            
            // è¨ˆç®—ç•¶å‰è£å‚™å¥—è£æ•ˆæœ
            const currentSetEffects = calculateSetEffects(currentWearingEquipment);
			
			// è¨ˆç®—äº”ç¶­ç¸½å€¼ï¼ˆåŸºç¤é¢æ¿ + è£å‚™ï¼‰
			const totalFiveStats = {
				strength: baseStats[10] + currentEquipmentStats[10],
				qihai: baseStats[11] + currentEquipmentStats[11],
				agility: baseStats[12] + currentEquipmentStats[12],
				constitution: baseStats[13] + currentEquipmentStats[13],
				endurance: baseStats[14] + currentEquipmentStats[14]
			};
            
            // æ‡‰ç”¨å¥—è£æ•ˆæœåˆ°è£å‚™å±¬æ€§
            applySetEffects(currentEquipmentStats, currentSetEffects, totalFiveStats);
            
            // æ‡‰ç”¨äº”ç¶­å±¬æ€§è½‰æ›
            applyFiveStatsConversion(currentEquipmentStats);
            
            const statLabels = [
                'æ”»æ“Š', 'å…ƒç´ æ”»æ“Š', 'ç ´é˜²', 'å¿½è¦–æŠ—æ€§', 'å‘½ä¸­', 'æœƒå¿ƒ', 'é¦–é ˜å…‹åˆ¶', 
                'é¦–é ˜å…‹åˆ¶%', 'æœƒå¿ƒå‚·å®³', 'ç ´ç›¾', 'åŠ›é‡', 'æ°£æµ·', 'èº«æ³•', 'æ ¹éª¨', 'è€åŠ›'
            ];
            
            let html = '<div class="space-y-1 max-h-80 overflow-y-auto pr-2">';
            for (let i = 0; i < 15; i++) {
                const newValue = i === 7 || i === 8 ? stats[i] * 100 : stats[i];
                const currentValue = i === 7 || i === 8 ? currentEquipmentStats[i] * 100 : currentEquipmentStats[i];
                const diff = newValue - currentValue;
                
                const diffColor = diff > 0 ? 'text-green-300' : diff < 0 ? 'text-red-300' : 'text-gray-300';
                const diffSign = diff > 0 ? '+' : '';
                const diffText = i === 7 || i === 8 ? 
                    `${diffSign}${diff.toFixed(2)}%` : 
                    `${diffSign}${Math.round(diff)}`;
                
                const newValueText = i === 7 || i === 8 ? 
                    `${newValue.toFixed(2)}%` : 
                    Math.round(newValue);
                
                const icon = diff > 0 ? 'fa-arrow-up text-green-300' : 
                            diff < 0 ? 'fa-arrow-down text-red-300' : 'fa-equals text-gray-300';
                
                html += `
                    <div class="flex justify-between items-center text-xs">
                        <span class="text-white">${statLabels[i]}:</span>
                        <div class="flex items-center space-x-2">
                            <span class="font-medium text-white">${newValueText}</span>
                            <span class="${diffColor}"><i class="fas ${icon} mr-1"></i>(${diffText})</span>
                        </div>
                    </div>
                `;
            }
            html += '</div>';
            
            newEquipmentStatsDiv.innerHTML = html;
            
            // æ·»åŠ å‹•ç•«æ•ˆæœ
            newEquipmentStatsDiv.classList.add('fade-in');
            setTimeout(() => {
                newEquipmentStatsDiv.classList.remove('fade-in');
            }, 500);
        }

        // å‚·å®³è¨ˆç®—åŠŸèƒ½
        function calculateDamage() {
            const targetSelect = document.getElementById('targetSelect');
            const selectedTarget = targetSelect.value;
            
            if (!selectedTarget || !TARGET_PRESETS[selectedTarget]) {
                alert('è«‹å…ˆé¸æ“‡ç›®æ¨™ï¼');
                return;
            }
            
            // æª¢æŸ¥æ˜¯å¦å·²è¨ˆç®—åŸºç¤é¢æ¿
            if (baseStats.every(stat => stat === 0)) {
                alert('è«‹å…ˆè¨ˆç®—åŸºç¤é¢æ¿ï¼');
                return;
            }
            
            const targetStats = TARGET_PRESETS[selectedTarget];
            
            try {
                // è¨ˆç®—ç•¶å‰ç¸½å±¬æ€§ (åŸºç¤é¢æ¿ + ç•¶å‰è£å‚™)
                const currentEquipmentStats = new Array(15).fill(0);
                
                EQUIPMENT_SLOTS.forEach(slot => {
                    const selectedItem = currentWearingEquipment[slot];
                    if (selectedItem && EQUIPMENT_PRESETS_BY_SLOT[slot][selectedItem]) {
                        const itemStats = EQUIPMENT_PRESETS_BY_SLOT[slot][selectedItem];
                        for (let i = 0; i < itemStats.length; i++) {
                            currentEquipmentStats[i] += itemStats[i];
                        }
                    }
                });
                
                // è¨ˆç®—ç•¶å‰è£å‚™å¥—è£æ•ˆæœ
                const currentSetEffects = calculateSetEffects(currentWearingEquipment);
				
				const totalFiveStatsCurrent = {
					strength: baseStats[10] + currentEquipmentStats[10],
					qihai:    baseStats[11] + currentEquipmentStats[11],
					agility:  baseStats[12] + currentEquipmentStats[12],
					constitution: baseStats[13] + currentEquipmentStats[13],
					endurance:    baseStats[14] + currentEquipmentStats[14]
				};
                
                // æ‡‰ç”¨å¥—è£æ•ˆæœåˆ°è£å‚™å±¬æ€§
                applySetEffects(currentEquipmentStats, currentSetEffects);
                
                // æ‡‰ç”¨äº”ç¶­å±¬æ€§è½‰æ›
                applyFiveStatsConversion(currentEquipmentStats);
                
                const currentTotalStats = {
                    attack: baseStats[0] + currentEquipmentStats[0],
                    elementalAttack: baseStats[1] + currentEquipmentStats[1],
                    armorBreak: baseStats[2] + currentEquipmentStats[2],
                    ignoreResist: baseStats[3] + currentEquipmentStats[3],
                    hit: baseStats[4] + currentEquipmentStats[4],
                    crit: baseStats[5] + currentEquipmentStats[5],
                    bossDamage: baseStats[6] + currentEquipmentStats[6],
                    bossDamagePercent: baseStats[7] + currentEquipmentStats[7],
                    critDamage: baseStats[8] + currentEquipmentStats[8],
                    shieldBreak: baseStats[9] + currentEquipmentStats[9]
                };
                
                // è¨ˆç®—æ–°è£å‚™ç¸½å±¬æ€§ (åŸºç¤é¢æ¿ + æ–°è£å‚™ + æ‰‹å‹•èª¿æ•´)
                const newEquipmentStats = new Array(15).fill(0);
                
                EQUIPMENT_SLOTS.forEach(slot => {
                    const selectedItem = newEquipment[slot];
                    if (selectedItem && EQUIPMENT_PRESETS_BY_SLOT[slot][selectedItem]) {
                        const itemStats = EQUIPMENT_PRESETS_BY_SLOT[slot][selectedItem];
                        for (let i = 0; i < itemStats.length; i++) {
                            newEquipmentStats[i] += itemStats[i];
                        }
                    }
                });
                
                // è¨ˆç®—æ–°è£å‚™å¥—è£æ•ˆæœ
                const newSetEffects = calculateSetEffects(newEquipment);
                
                // æ‡‰ç”¨å¥—è£æ•ˆæœåˆ°è£å‚™å±¬æ€§
                applySetEffects(newEquipmentStats, newSetEffects);
                
                // æ‡‰ç”¨äº”ç¶­å±¬æ€§è½‰æ›
                applyFiveStatsConversion(newEquipmentStats);
                
                // ç²å–æ‰‹å‹•èª¿æ•´å€¼
                const manualAdjustments = {
                    attack: parseFloat(document.getElementById('manual_attack').value) || 0,
                    elementalAttack: parseFloat(document.getElementById('manual_elemental_attack').value) || 0,
                    armorBreak: parseFloat(document.getElementById('manual_armor_break').value) || 0,
                    ignoreResist: parseFloat(document.getElementById('manual_ignore_resist').value) || 0,
                    hit: parseFloat(document.getElementById('manual_hit').value) || 0,
                    crit: parseFloat(document.getElementById('manual_crit').value) || 0,
                    bossDamage: parseFloat(document.getElementById('manual_boss_damage').value) || 0,
                    bossDamagePercent: parseFloat(document.getElementById('manual_boss_damage_percent').value) || 0,
                    critDamage: parseFloat(document.getElementById('manual_crit_damage').value) || 0,
                    shieldBreak: 0,
                    strength: parseFloat(document.getElementById('manual_strength').value) || 0,
                    qihai: parseFloat(document.getElementById('manual_qihai').value) || 0,
                    agility: parseFloat(document.getElementById('manual_agility').value) || 0,
                    constitution: parseFloat(document.getElementById('manual_constitution').value) || 0,
                    endurance: parseFloat(document.getElementById('manual_endurance').value) || 0
                };
                
                // å°‡æ‰‹å‹•å¾®èª¿çš„äº”ç¶­å±¬æ€§è½‰æ›ç‚ºæˆ°é¬¥å±¬æ€§
                const manualFiveStatsArray = new Array(15).fill(0);
                manualFiveStatsArray[10] = manualAdjustments.strength;
                manualFiveStatsArray[11] = manualAdjustments.qihai;
                manualFiveStatsArray[12] = manualAdjustments.agility;
                manualFiveStatsArray[13] = manualAdjustments.constitution;
                manualFiveStatsArray[14] = manualAdjustments.endurance;

                // æ‡‰ç”¨äº”ç¶­è½‰æ›
                applyFiveStatsConversion(manualFiveStatsArray);
                
                // è¨ˆç®—æ–°é…ç½®ç¸½å±¬æ€§ï¼ˆåŒ…å«æ‰‹å‹•èª¿æ•´ï¼‰
                const newTotalStats = {
                    attack: baseStats[0] + newEquipmentStats[0] + manualAdjustments.attack + manualFiveStatsArray[0],
                    elementalAttack: baseStats[1] + newEquipmentStats[1] + manualAdjustments.elementalAttack + manualFiveStatsArray[1],
                    armorBreak: baseStats[2] + newEquipmentStats[2] + manualAdjustments.armorBreak + manualFiveStatsArray[2],
                    ignoreResist: baseStats[3] + newEquipmentStats[3] + manualAdjustments.ignoreResist + manualFiveStatsArray[3],
                    hit: baseStats[4] + newEquipmentStats[4] + manualAdjustments.hit + manualFiveStatsArray[4],
                    crit: baseStats[5] + newEquipmentStats[5] + manualAdjustments.crit + manualFiveStatsArray[5],
                    bossDamage: baseStats[6] + newEquipmentStats[6] + manualAdjustments.bossDamage + manualFiveStatsArray[6],
                    bossDamagePercent: baseStats[7] + newEquipmentStats[7] + (manualAdjustments.bossDamagePercent / 100) + manualFiveStatsArray[7],
                    critDamage: baseStats[8] + newEquipmentStats[8] + (manualAdjustments.critDamage / 100) + manualFiveStatsArray[8],
                    shieldBreak: baseStats[9] + newEquipmentStats[9] + manualAdjustments.shieldBreak + manualFiveStatsArray[9]
                };
                
                // è¨ˆç®—å‚·å®³
                const currentDamage = calculateSingleDamage(currentTotalStats, targetStats);
                const newDamage = calculateSingleDamage(newTotalStats, targetStats);
                
                // è¨ˆç®—å·®ç•°
                const damageDiff = newDamage - currentDamage;
                const damageIncrease = currentDamage > 0 ? (damageDiff / currentDamage * 100) : 0;
                
                // é¡¯ç¤ºçµæœ
                displayDamageResults(currentDamage, newDamage, damageDiff, damageIncrease);
            } catch (error) {
                console.error('è¨ˆç®—å‚·å®³æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                alert('è¨ˆç®—å‚·å®³æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥è¼¸å…¥å€¼');
            }
        }
        
        function calculateSingleDamage(stats, targetStats) {
            // å›ºå®šå€¼
            const BASE_SKILL = 0;
            const SKILL_ENHANCE = 0;
            const ATTACK_SPEED = 0;
            const BOSS_RESIST = 0; // é¦–é ˜æŠµç¦¦
            
            // é˜²ç¦¦ç©¿é€ç‡è¨ˆç®—
            const defenseAfterBreak = Math.max(0, targetStats.defense - stats.armorBreak);
            const defensePenetration = 1 - (defenseAfterBreak / (defenseAfterBreak + 2860));
            
            // å…ƒç´ ç©¿é€ç‡è¨ˆç®—
            const elementalResistAfterIgnore = Math.max(0, targetStats.elemental_resist - stats.ignoreResist);
            const elementalPenetration = 1 - (elementalResistAfterIgnore / (elementalResistAfterIgnore + 520));
            
            // çœŸå¯¦å‘½ä¸­è¨ˆç®—
            const realHit = (1.4315 * stats.hit) / (stats.hit + 714);
            
            // çœŸå¯¦æ ¼æ“‹è¨ˆç®—
            const realBlock = (1.44 * targetStats.block) / (targetStats.block + 722);
            
            // å‘½ä¸­ç‡è¨ˆç®—
            const hitRate = Math.min(1, Math.max(0, 0.95 + (realHit - realBlock)));
            
            // æœƒå¿ƒç‡è¨ˆç®—
            const critDiff = Math.max(0, stats.crit - targetStats.crit_resist + 90);
            const critRate = Math.min(1, Math.max(0, (1.15 * critDiff) / (critDiff + 941)));
            
            // å‚·å®³è¨ˆç®—
            const physicalDamage = (stats.attack + stats.bossDamage - BOSS_RESIST - targetStats.shield_base + BASE_SKILL) * defensePenetration;
            const elementalDamage = stats.elementalAttack * elementalPenetration;
            
            const baseDamage = physicalDamage + elementalDamage;
            
            const hitMultiplier = hitRate * (critRate * stats.critDamage + (1 - critRate)) + (1 - hitRate) * 0.5;
            const bossMultiplier = 1 + stats.bossDamagePercent;
            const skillMultiplier = 1 + SKILL_ENHANCE;
            const speedMultiplier = 1 + ATTACK_SPEED / 2;
            
            const finalDamage = baseDamage * hitMultiplier * bossMultiplier * skillMultiplier * speedMultiplier;
            
            return Math.max(0, finalDamage);
        }
        
        function displayDamageResults(currentDamage, newDamage, damageDiff, damageIncrease) {
            const resultsDiv = document.getElementById('damageResults');
            
            const diffColor = damageDiff >= 0 ? 'text-green-300' : 'text-red-500';
            const diffBg = damageDiff >= 0 ? 'bg-green-900 bg-opacity-20 border-green-300' : 'bg-red-900 bg-opacity-20 border-red-700';
            const diffSign = damageDiff >= 0 ? '+' : '';
            
            const increaseColor = damageIncrease >= 0 ? 'text-green-300' : 'text-red-500';
            const increaseBg = damageIncrease >= 0 ? 'bg-green-900 bg-opacity-20 border-green-300' : 'bg-red-900 bg-opacity-20 border-red-700';
            const increaseSign = damageIncrease >= 0 ? '+' : '';
            
            const damageClass = damageDiff >= 0 ? 'damage-increase' : 'damage-decrease';
            
            resultsDiv.innerHTML = `
                <div class="space-y-3 fade-in">
                    <div class="${damageClass} damage-result-card ${diffBg}">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="text-xs mb-1 text-white">å‚·å®³å·®ç•°</div>
                                <div class="text-xl font-bold ${diffColor}">${diffSign}${Math.round(damageDiff).toLocaleString()}</div>
                            </div>
                            <div class="text-3xl ${diffColor}">
                                ${damageDiff >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰'}
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-blue-900 bg-opacity-20 p-3 rounded-lg border border-blue-300">
                            <div class="text-xs mb-1 text-white">ç•¶å‰é…ç½®å‚·å®³</div>
                            <div class="text-lg font-bold text-white">${Math.round(currentDamage).toLocaleString()}</div>
                        </div>
                        
                        <div class="bg-purple-900 bg-opacity-20 p-3 rounded-lg border border-purple-300">
                            <div class="text-xs mb-1 text-white">æ–°é…ç½®å‚·å®³</div>
                            <div class="text-lg font-bold text-white">${Math.round(newDamage).toLocaleString()}</div>
                        </div>
                    </div>
                    
                    <div class="${increaseBg} p-3 rounded-lg border">
                        <div class="text-xs mb-1 text-white">å¢å‚·ç™¾åˆ†æ¯”</div>
                        <div class="text-lg font-bold ${increaseColor}">${increaseSign}${damageIncrease.toFixed(2)}%</div>
                    </div>
                </div>
            `;
            
            // æ·»åŠ å‹•ç•«æ•ˆæœ
            setTimeout(() => {
                resultsDiv.querySelector('.fade-in').classList.remove('fade-in');
            }, 500);
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', loadExternalData);
		
		//æ˜Ÿæ˜Ÿå‹•ç•«æ•ˆæœ
		function createStars() {
			const starsContainer = document.getElementById('stars');
			const starCount = 400; // æ˜Ÿæ˜Ÿæ•¸é‡

			for (let i = 0; i < starCount; i++) {
				const star = document.createElement('div');
				star.className = 'star';
				const size = Math.random() * 3 + 0.5;
				const opacity = Math.random() * 0.8 + 0.2;
				star.style.cssText = `
					left: ${Math.random() * 100}%;
					top: ${Math.random() * 100}%;
					width: ${size}px;
					height: ${size}px;
					opacity: ${opacity};
					animation-delay: ${Math.random() * 4}s;
					animation-duration: ${Math.random() * 4 + 2}s;
				`;
				starsContainer.appendChild(star);
			}
		}
		createStars();
    </script>

</body>
</html>